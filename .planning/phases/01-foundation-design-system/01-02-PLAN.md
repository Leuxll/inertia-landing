---
phase: 01-foundation-design-system
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/providers/lenis-provider.tsx
  - src/app/layout.tsx
  - src/lib/config.ts
  - src/lib/animations.ts
  - src/components/ui/scroll-reveal.tsx
autonomous: true

must_haves:
  truths:
    - "Desktop scroll feels smooth and cinematic with slight momentum (Lenis)"
    - "Touch devices use native scroll (Lenis disabled)"
    - "CTA_MODE=waitlist shows a waitlist-state element on the page"
    - "CTA_MODE=download shows a download-state element on the page"
    - "Scroll-triggered reveal animations work on the placeholder page"
  artifacts:
    - path: "src/components/providers/lenis-provider.tsx"
      provides: "Client component wrapping children with ReactLenis smooth scroll"
      contains: "use client"
    - path: "src/lib/config.ts"
      provides: "Centralized config reading CTA_MODE from process.env"
      exports: ["ctaMode", "isWaitlistMode", "isDownloadMode"]
    - path: "src/lib/animations.ts"
      provides: "Shared Motion animation variants and transition presets"
      exports: ["fadeUp", "fadeIn", "staggerContainer", "cinematicTransition"]
    - path: "src/components/ui/scroll-reveal.tsx"
      provides: "Reusable scroll-triggered animation wrapper using Motion"
      contains: "use client"
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/components/providers/lenis-provider.tsx"
      via: "LenisProvider wrapping body children"
      pattern: "LenisProvider"
    - from: "src/components/ui/scroll-reveal.tsx"
      to: "src/lib/animations.ts"
      via: "Imports shared animation variants"
      pattern: "import.*animations"
    - from: "src/lib/config.ts"
      to: "process.env.CTA_MODE"
      via: "Reads env var at build time"
      pattern: "process\\.env\\.CTA_MODE"
---

<objective>
Add smooth scrolling (Lenis), the CTA state configuration system, and the animation foundation. These are the behavioral systems that sit on top of the scaffold from Plan 01.

Purpose: The scroll behavior, CTA state switching, and animation system are architectural patterns that every section in Phase 2+ depends on.
Output: Smooth scrolling active on desktop, CTA_MODE env var driving visible page state, and reusable animation primitives ready for component use.
</objective>

<execution_context>
@/Users/yuefunglee/.config/opencode/get-shit-done/workflows/execute-plan.md
@/Users/yuefunglee/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-design-system/01-CONTEXT.md
@.planning/phases/01-foundation-design-system/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Lenis smooth scroll provider and CTA config system</name>
  <files>
    src/components/providers/lenis-provider.tsx
    src/app/layout.tsx
    src/lib/config.ts
  </files>
  <action>
    1. **lenis-provider.tsx** — Create the smooth scroll provider:
       ```tsx
       "use client";

       import { ReactLenis } from "lenis/react";

       export function LenisProvider({ children }: { children: React.ReactNode }) {
         return (
           <ReactLenis
             root
             options={{
               lerp: 0.1,           // Subtle momentum, not aggressive
               duration: 1.2,       // Cinematic scroll duration
               smoothWheel: true,
               touchSmooth: false,   // Native scroll on touch devices
             }}
           >
             {children}
           </ReactLenis>
         );
       }
       ```

       Key points:
       - `"use client"` directive required (Lenis uses browser APIs)
       - `root` prop makes Lenis control the document scroll
       - `touchSmooth: false` ensures native scroll on mobile/touch (per research pitfall guidance)
       - `lerp: 0.1` gives subtle momentum that doesn't fight user intent
       - Import from `lenis/react` (NOT `@studio-freight/react-lenis` which is deprecated)

    2. **layout.tsx** — Wrap body children with LenisProvider:
       Update the existing layout.tsx (from Plan 01) to import and wrap children:
       ```tsx
       import { LenisProvider } from "@/components/providers/lenis-provider";
       ```
       Wrap `{children}` inside `<body>` with `<LenisProvider>{children}</LenisProvider>`.

       IMPORTANT: Keep all existing font loading, metadata, and className logic. Only add the LenisProvider import and wrapper.

    3. **config.ts** — CTA state configuration:
       ```tsx
       // CTA mode is determined at build time via environment variable.
       // Changing CTA_MODE requires a redeploy (by design — avoids caching issues).
       // See: .env.local for local development, Vercel dashboard for production.

       export type CtaMode = "waitlist" | "download";

       export const ctaMode: CtaMode =
         (process.env.NEXT_PUBLIC_CTA_MODE as CtaMode) || "waitlist";

       export const isWaitlistMode = ctaMode === "waitlist";
       export const isDownloadMode = ctaMode === "download";
       ```

       IMPORTANT: Use `NEXT_PUBLIC_CTA_MODE` (not `CTA_MODE`) because this value needs to be available in Client Components. Next.js only exposes env vars prefixed with `NEXT_PUBLIC_` to the browser.

       Also update `.env.local` and `.env.example` to use `NEXT_PUBLIC_CTA_MODE` instead of `CTA_MODE`:
       ```
       NEXT_PUBLIC_CTA_MODE=waitlist
       ```

    4. Verify Lenis is working:
       - Run `pnpm dev`, scroll on desktop — should feel smooth with slight momentum
       - Test on mobile viewport (Chrome DevTools device mode) — should feel like native scroll
       - No console errors about Lenis initialization
  </action>
  <verify>
    - `pnpm dev` starts without errors
    - Scrolling on desktop has smooth momentum feel
    - DevTools console shows no Lenis errors
    - `src/lib/config.ts` exports ctaMode, isWaitlistMode, isDownloadMode
    - `.env.local` has NEXT_PUBLIC_CTA_MODE=waitlist
    - `pnpm build` succeeds
  </verify>
  <done>Lenis smooth scroll active on desktop with touch fallback, CTA config system exports build-time mode from env var</done>
</task>

<task type="auto">
  <name>Task 2: Animation system and scroll-reveal component with page demo</name>
  <files>
    src/lib/animations.ts
    src/components/ui/scroll-reveal.tsx
    src/app/page.tsx
  </files>
  <action>
    1. **animations.ts** — Shared Motion animation variants and transitions:
       ```tsx
       // Shared animation presets for the Momentum landing page.
       // All animations use compositor-only properties (transform, opacity) for performance.
       // Easing: smooth ease-out / ease-in-out — no bounce or spring physics.

       export const cinematicTransition = {
         duration: 0.7,
         ease: [0.25, 0.1, 0.25, 1.0], // Smooth ease-out cubic bezier
       };

       export const smoothTransition = {
         duration: 0.5,
         ease: [0.42, 0, 0.58, 1.0], // ease-in-out cubic bezier
       };

       // Fade up from below — editorial reveal
       export const fadeUp = {
         hidden: { opacity: 0, y: 30 },
         visible: {
           opacity: 1,
           y: 0,
           transition: cinematicTransition,
         },
       };

       // Simple fade in
       export const fadeIn = {
         hidden: { opacity: 0 },
         visible: {
           opacity: 1,
           transition: cinematicTransition,
         },
       };

       // Stagger children container
       export const staggerContainer = {
         hidden: {},
         visible: {
           transition: {
             staggerChildren: 0.15,
             delayChildren: 0.1,
           },
         },
       };
       ```

       Key points:
       - Import from `motion/react` (NOT `framer-motion` — the library is now called Motion)
       - Only animate `transform` and `opacity` (compositor-only properties, per research)
       - Use cubic-bezier easing, no spring physics (per CONTEXT decisions)
       - These variants will be used by scroll-reveal and directly by components

    2. **scroll-reveal.tsx** — Reusable scroll-triggered animation wrapper:
       ```tsx
       "use client";

       import { motion } from "motion/react";
       import { fadeUp, staggerContainer } from "@/lib/animations";
       import type { ReactNode } from "react";

       interface ScrollRevealProps {
         children: ReactNode;
         className?: string;
         variant?: "fadeUp" | "stagger";
         delay?: number;
       }

       export function ScrollReveal({
         children,
         className,
         variant = "fadeUp",
         delay = 0,
       }: ScrollRevealProps) {
         const variants = variant === "stagger" ? staggerContainer : fadeUp;

         return (
           <motion.div
             initial="hidden"
             whileInView="visible"
             viewport={{ once: true, margin: "-100px" }}
             variants={variants}
             className={className}
             style={delay ? { transitionDelay: `${delay}s` } : undefined}
           >
             {children}
           </motion.div>
         );
       }
       ```

       Key points:
       - `viewport={{ once: true }}` — animate only on first scroll into view (not every time)
       - `margin: "-100px"` — trigger slightly before element enters viewport for natural feel
       - `"use client"` required for Motion
       - Supports stagger variant for parent containers with multiple animated children

    3. **page.tsx** — Update the placeholder page to demonstrate all systems working:
       Replace the placeholder page (from Plan 01) with a page that demonstrates:

       a. **Scroll-triggered reveals**: Wrap content sections in ScrollReveal so they animate in on scroll. Include enough content to require scrolling (at least 2 full-height sections).

       b. **CTA state switching**: Import `ctaMode`, `isWaitlistMode` from `@/lib/config`. Show a visible element that changes based on state:
          - If waitlist mode: Show the white button labeled "Get Early Access" with a small note "Waitlist mode active"
          - If download mode: Show the white button labeled "Download on App Store" with a small note "Download mode active"
          - This proves the env var plumbing works end-to-end

       c. **Typography and theme demo**: Keep the Playfair headline and Inter body text from Plan 01, but now organized into distinct sections with ScrollReveal.

       d. **Responsive layout**: Use `min-h-dvh` (not `min-h-screen`) for full-height sections. Center content with max-w and auto margins. Adjust headline size responsively (text-4xl on mobile, text-7xl+ on desktop).

       Page structure (Server Component that composes client components):
       ```
       Section 1 (min-h-dvh): "Momentum" headline + subtitle + CTA state demo
       Divider
       Section 2 (min-h-dvh): Secondary content with scroll-reveal animation
       ```

       The page MUST be a Server Component (no "use client"). It imports and uses ScrollReveal (client) and reads config (server-safe since it reads env at build time).
  </action>
  <verify>
    - `pnpm dev` loads with scroll-triggered animations on the placeholder sections
    - Scrolling down reveals the second section with a fade-up animation
    - CTA button shows "Get Early Access" (because NEXT_PUBLIC_CTA_MODE=waitlist in .env.local)
    - Change `.env.local` to `NEXT_PUBLIC_CTA_MODE=download`, restart dev server — button changes to "Download on App Store"
    - `pnpm build` succeeds
    - No hydration mismatches or console errors
  </verify>
  <done>Animation system working with scroll-triggered reveals, CTA state visible on page and switchable via env var, responsive layout with 100dvh sections</done>
</task>

</tasks>

<verification>
- Lenis smooth scroll active on desktop (smooth momentum on wheel scroll)
- Touch/mobile scroll uses native behavior (no Lenis interference)
- ScrollReveal animations trigger on scroll into view
- NEXT_PUBLIC_CTA_MODE=waitlist shows "Get Early Access" button
- NEXT_PUBLIC_CTA_MODE=download shows "Download on App Store" button
- Page has two full-height (min-h-dvh) sections with responsive typography
- `pnpm build` succeeds, no console errors
</verification>

<success_criteria>
- Lenis provider wraps layout, smooth scroll works on desktop
- CTA config system reads NEXT_PUBLIC_CTA_MODE and exports typed helpers
- Animation variants defined in lib/animations.ts
- ScrollReveal component triggers animations on viewport entry
- Page demonstrates CTA state switching end-to-end
- All sections use 100dvh, layout is responsive
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-design-system/01-02-SUMMARY.md`
</output>
